<div x-data="{ tab: 'design' }" class="pb-20">
  <nav class="tab">
    <div class="container mx-auto flex w-100 px-1">
      <button class="tab-link active" :class="{ 'active': tab === 'design' }" @click="tab = 'design'">Design</button>
      <button class="tab-link" :class="{ 'active': tab === 'code' }" @click="tab = 'code'">Code</button>
      <button
        class="tab-link ml-auto"
        x-ref="copyCodeButton"
        @click="$refs.copyCode.select(); document.execCommand('copy'); $refs.copyCodeButton.innerText = 'Copied!'; setTimeout(function() {$refs.copyCodeButton.innerText = 'Copy Code'}, 1000);"
      >
        Copy Code
      </button>
    </div>
  </nav>

  <!-- To display the component -->
  <div class="mb-2 overflow-visible bg-white border-b-2 border-gray-200" x-show="tab === 'design'">
    <label class="tag-label">
      <span class="sr-only">Get in my range</span>
      <input type="range" class="tag-range resize-handle" value="100" />
    </label>

    <iframe
      style="height: 300px; min-width: 320px;"
      onload='javascript:(function(o){o.style.height=o.contentWindow.document.body.scrollHeight+"px";}(this));'
      class="w-full"
      loading="lazy"
      srcdoc="<!DOCTYPE html>
      <meta charset='utf-8' />
      <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no' />
      <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1' />
      <link rel='stylesheet' href='/build.css' />
      <script src='/kutty.js'></script>
      {{ .Inner | safeHTMLAttr }}"
    >
    </iframe>
  </div>

  <!-- To display the code -->
  <div class="bg-gray-200 mb-2 outline-none relative overflow-y-auto" x-show="tab === 'code'" style="max-height: 300px;" x-cloak>
    {{ if len .Params | eq 2 }} {{ highlight (trim .Inner "\n\r") (.Get 0) (.Get 1) }} {{ else }} {{ highlight (trim .Inner "\n\r") (.Get 0) "" }} {{ end }}
  </div>

  <textarea class="sr-only whitespace-pre-wrap" x-ref="copyCode" aria-hidden="true" readonly="true">{{ .Inner | safeHTMLAttr }}</textarea>
</div>

<script>
  window.addEventListener('DOMContentLoaded', function(event) {
    const sliders = document.querySelectorAll('.resize-handle');

    sliders.forEach(function(slider, index) {
      slider.addEventListener('input', function(event) {
        let iframe = event.target.parentElement.parentElement.querySelector('iframe');
        iframe.classList.remove('w-full');
        iframe.width = event.target.value + '%';
        iframe.style.height = '0px';
        let scrollHeight = iframe.contentWindow.document.body.scrollHeight;
        iframe.style.height = scrollHeight + 'px';
      })
    })
  });
</script>
